<h1 style="text-align:center; margin:20px 0;">プロフィール編集</h1>

<%# エラーメッセージ表示 %>
<% if @user.errors.any? %>
  <div style="color: #d32f2f; background-color: #ffebee; padding: 15px; margin: 20px auto; max-width: 500px; border-radius: 6px; border-left: 4px solid #d32f2f;">
    <h3 style="margin-top: 0; font-size: 16px;">
      <%= pluralize(@user.errors.count, "個のエラー") %>がありました:
    </h3>
    <ul style="margin: 10px 0 0 20px; padding: 0;">
      <% @user.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
    </ul>
  </div>
<% end %>

<%# アラートメッセージ表示 %>
<% if flash[:alert] %>
  <div style="color: #d32f2f; background-color: #ffebee; padding: 15px; margin: 20px auto; max-width: 500px; border-radius: 6px; border-left: 4px solid #d32f2f;">
    <%= flash[:alert] %>
  </div>
<% end %>

<%# 成功メッセージ表示 %>
<% if flash[:notice] %>
  <div style="color: #388e3c; background-color: #e8f5e9; padding: 15px; margin: 20px auto; max-width: 500px; border-radius: 6px; border-left: 4px solid #388e3c;">
    <%= flash[:notice] %>
  </div>
<% end %>

<%= form_with model: @user, url: profile_path, method: :patch, local: true, data: { turbo: false }, html: { multipart: true } do |f| %>
  <div style="max-width: 500px; margin: 0 auto; display: flex; flex-direction: column; gap: 15px;">
    
    <!-- ユーザー名 -->
    <div>
      <%= f.label :display_name, "ユーザー名", style: "font-weight: bold; display: block; margin-bottom: 5px;" %>
      <%= f.text_field :display_name, 
          value: @user.display_name,
          placeholder: "ユーザー名を入力してください",
          style: "width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px; box-sizing: border-box;" %>
      <small style="color: #666; font-size: 12px;">※未入力の場合はメールアドレスから自動生成されます</small>
    </div>

    <!-- アバター -->
    <div>
      <%= f.label :avatar, "アバター画像", style: "font-weight: bold; display: block; margin-bottom: 5px;" %>
      <% if @user.avatar.attached? %>
        <div style="margin-bottom: 10px;">
          <%= image_tag @user.avatar.variant(resize_to_limit: [100, 100]), 
              style: "border-radius: 50%; border: 2px solid #ddd;" %>
          <p style="font-size: 12px; color: #666; margin-top: 5px;">現在のアバター</p>
        </div>
      <% end %>
      <%= f.file_field :avatar, 
          accept: "image/*",
          style: "width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px; box-sizing: border-box;" %>
      <small style="color: #666; font-size: 12px;">※JPG、PNG、GIF形式の画像をアップロードできます</small>
    </div>

    <!-- 自己紹介 -->
    <div>
      <%= f.label :bio, "自己紹介", style: "font-weight: bold; display: block; margin-bottom: 5px;" %>
      <%= f.text_area :bio, 
          rows: 5,
          placeholder: "自己紹介を入力してください",
          style: "width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px; resize: vertical; box-sizing: border-box;" %>
      <small style="color: #666; font-size: 12px;">※あなたについて自由に記載してください</small>
    </div>

    <!-- ボタン -->
    <div style="display: flex; gap: 10px; margin-top: 10px;">
      <%= f.submit "更新する", 
          style: "flex: 1; padding: 12px 20px; border-radius: 6px; background-color: #4CAF50; color: white; border: none; cursor: pointer; font-size: 16px; font-weight: bold; transition: background-color 0.3s;" %>
      <%= link_to "キャンセル", profile_path, 
          style: "flex: 1; padding: 12px 20px; border-radius: 6px; background-color: #f5f5f5; color: #333; border: 1px solid #ddd; text-decoration: none; text-align: center; font-size: 16px; transition: background-color 0.3s; display: inline-block; box-sizing: border-box;" %>
    </div>

  </div>
<% end %>

<style>
  input[type="submit"]:hover {
    background-color: #45a049 !important;
  }
  
  a[href*="profile"]:hover {
    background-color: #e0e0e0 !important;
  }
</style>